<div class="movs-container">
  <!-- üß© Filtros (sin Documento) -->
  <div class="filtros-card">
    <div class="filtros-grid centrado">
      <div class="filtro-item">
        <label for="m-prod">Producto</label>
        <input id="m-prod" type="text" placeholder="Martillo, taladro‚Ä¶" [(ngModel)]="filtroProducto">
      </div>

      <div class="filtro-item">
        <label for="m-tipo">Tipo</label>
        <select id="m-tipo" [(ngModel)]="filtroTipo">
          <option value="">Todos</option>
          <option value="entrada">Entrada</option>
          <option value="salida">Salida</option>
        </select>
      </div>

      <div class="filtro-item">
        <label for="m-desde">Fecha desde</label>
        <input id="m-desde" type="date" [(ngModel)]="filtroDesde">
      </div>

      <div class="filtro-item">
        <label for="m-hasta">Fecha hasta</label>
        <input id="m-hasta" type="date" [(ngModel)]="filtroHasta">
      </div>

      <div class="filtro-botones">
        <button class="btn-filtrar" type="button" (click)="aplicarFiltros()">Filtrar</button>
        <button class="btn-limpiar" type="button" (click)="limpiarFiltros()">Limpiar</button>
      </div>

    </div>
  </div>

  <!-- üí∞ Resumen -->

  <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
    <!-- Total de movimientos -->
    <div class="bg-white shadow-md rounded-2xl p-4 text-center">
      <p class="text-gray-500 text-sm">Movimientos Totales</p>
      <p class="text-2xl font-semibold">{{ totalMovimientos }}</p>
    </div>

    <!-- √öltimo movimiento -->
    <div class="bg-white shadow-md rounded-2xl p-4 text-center">
      <p class="text-gray-500 text-sm">√öltimo Movimiento</p>
      <p *ngIf="ultimoMovimiento; else sinMov">
        {{ ultimoMovimiento.fecha | date:'dd/MM/yyyy HH:mm' }} ‚Äî
        <span class="font-medium">{{ obtenerTipoMovimiento(ultimoMovimiento!) }}</span>
      </p>
      <ng-template #sinMov>
        <p>No hay movimientos</p>
      </ng-template>
    </div>

    <!-- Variaci√≥n neta -->
    <div class="bg-white shadow-md rounded-2xl p-4 text-center">
      <p class="text-gray-500 text-sm">Variaci√≥n Total (u.)</p>
      <p [ngClass]="{
            'text-green-600': variacion > 0,
            'text-red-600': variacion < 0,
            'text-gray-700': variacion === 0
          }" class="text-2xl font-semibold">
        {{ variacion > 0 ? '+' : '' }}{{ variacion }}
      </p>
    </div>
  </div>


  <!-- üìã Tabla Kardex (sin Documento) -->
  <div class="tabla-card">
    <h2>Kardex</h2>
    <table>
      <thead>
        <tr>
          <th style="text-align: center;">Fecha</th>
          <th style="text-align: center;">Producto</th>
          <th style="text-align: center;">Tipo</th>
          <th class="num" style="text-align: center;">Ingreso</th>
          <th class="num" style="text-align: center;">Salida</th>
          <th class="num" style="text-align: center;">Saldo</th>
          <th class="fit" style="text-align: center;">Acciones</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let aud of auditorias">
          <td style="text-align: center;">{{ aud.fecha | date:'dd/MM/yyyy' }}</td>
          <td style="text-align: center;">{{ aud.producto.nombreProducto }}</td>

          <!-- Tipo -->
          <td style="text-align: center;">
            <span class="tag" [ngClass]="{
            'in': aud.cantidadNueva > aud.cantidadAnterior,
            'out': aud.cantidadNueva < aud.cantidadAnterior
          }">
              {{ aud.cantidadNueva > aud.cantidadAnterior ? 'Entrada' : 'Salida' }}
            </span>
          </td>

          <!-- Ingreso (+n o ‚Äî) -->
          <td class="num" style="text-align: center;">
            {{
            aud.cantidadNueva > aud.cantidadAnterior
            ? ('+' + (aud.cantidadNueva - aud.cantidadAnterior))
            : '‚Äî'
            }}
          </td>

          <!-- Salida (‚Äîn o ‚Äî) -->
          <td class="num" style="text-align: center;">
            {{
            aud.cantidadNueva < aud.cantidadAnterior ? ('‚àí' + (aud.cantidadAnterior - aud.cantidadNueva)) : '‚Äî' }} </td>

              <!-- Saldo actual -->
          <td class="num" style="text-align: center;">{{ aud.cantidadNueva }}</td>

          <!-- Acciones -->
          <td class="acciones text-center" style="text-align: center;">
            <button class="btn-ver" type="button" (click)="abrirModalVer(aud)">Ver</button>
          </td>
        </tr>
      </tbody>
    </table>


    <!-- Paginaci√≥n: SOLO FLECHAS -->
    <nav class="pager" aria-label="Paginaci√≥n">
      <a (click)="atrasarPagina()" class="arrow prev cursor-pointer" aria-label="Anterior">‚Äπ</a>
      <span class="pager__info">{{pagina + 1}} / {{totalPaginas}}</span>
      <a (click)="avanzarPagina()" class="arrow next cursor-pointer" aria-label="Siguiente">‚Ä∫</a>
    </nav>
  </div>
</div>
<!-- ü™ü Modal Ver Detalle de Movimiento -->
<div *ngIf="mostrarModalVer" class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50">
  <div class="bg-white rounded-2xl shadow-lg w-full max-w-md p-6 relative">

    <!-- ‚ùå Bot√≥n cerrar -->
    <button (click)="cerrarModalVer()"
      class="absolute top-3 right-3 text-gray-500 hover:text-gray-700 text-2xl font-bold" aria-label="Cerrar">
      √ó
    </button>

    <h2 class="text-xl font-semibold mb-4 text-gray-800 text-center">Detalle de movimiento</h2>

    <!-- üìã Detalles -->
    <div class="space-y-3 text-gray-700" style="text-align: center;">
      <div>
        <strong>üìÖ Fecha y hora:</strong>
        <p>{{ movimientoSeleccionado?.fecha | date:'dd/MM/yyyy HH:mm' }}</p>
      </div>

      <div>
        <strong>üë∑ Trabajador:</strong>
        <p>{{ movimientoSeleccionado!.trabajador.nombreTrabajador }}
          {{movimientoSeleccionado!.trabajador.apellidoTrabajador }}</p>
      </div>

      <div>
        <strong>‚öôÔ∏è Acci√≥n:</strong>
        <p [ngClass]="{
              'text-green-600 font-semibold': movimientoSeleccionado!.cantidadNueva > movimientoSeleccionado!.cantidadAnterior,
              'text-red-600 font-semibold': movimientoSeleccionado!.cantidadNueva < movimientoSeleccionado!.cantidadAnterior
            }">
          {{ movimientoSeleccionado!.cantidadNueva > movimientoSeleccionado!.cantidadAnterior ? 'Entrada' : 'Salida' }}
        </p>
      </div>

      <div>
        <strong>üì¶ Producto:</strong>
        <p>{{ movimientoSeleccionado?.producto?.nombreProducto}}:
          {{movimientoSeleccionado!.producto.descripcionProducto}}</p>
      </div>

      <div>
        <strong>üìã Detalle del cambio:</strong>
        <p>
          {{
          movimientoSeleccionado?.referencia
          }}
        </p>
      </div>
    </div>

    <!-- üß© Bot√≥n cerrar -->
    <div class="mt-6 flex justify-center">
      <button (click)="cerrarModalVer()"
        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
        Cerrar
      </button>
    </div>
  </div>
</div>